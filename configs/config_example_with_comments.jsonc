{
  // ============================================
  // CONFIGURATION FILE FOR AUTOMATED FINE-TUNING
  // ============================================
  
  "dataset": {
    "type": "file",                    // Options: "file", "huggingface", "folder"
    "name": "finance_bench_test3",     // Dataset identifier
    "path": "train_data_5k.csv",       // Path to dataset file
    "hf_token": "your_token_here",     // HuggingFace token (if using HF datasets)
    "splitter": "csv",                 // Options: "csv", "json", "pdf"
    "input_fields": ["question"],      // Column names for input
    "output_fields": ["answer"],       // Column names for output
    "batch_config": {
      "first_batch": 0.10,             // 10% of training data for exp1
      "second_batch": 0.20,            // 20% of training data for exp2
      "third_batch": 0.30,             // 30% of training data for exp3
      "test_batch": 0.05               // 5% of test data for evaluation
    }
  },

  "output_dir": "output_res",          // Directory to save results

  "system_prompt": "You are a helpful assistant.",

  "experiments": {
    
    // ============================================
    // EXPERIMENT 1: Baseline (Always Runs)
    // ============================================
    "exp1": {
      "run_always": true,              // Always execute this experiment
      "train_batch": "first_batch",    // Use first_batch (10% data)
      "model": {
        "model_name": "unsloth/Qwen3-0.6B",
        "rank": 32,
        "alpha": 64,
        "max_seq_len": 2048,
        "dropout": 0,
        "chat_template": "qwen3-instruct"
      },
      "sft": {
        "learning_rate": 2e-5,
        "batch_size": 8,
        "epochs": 2,
        "early_stopping_criteria": false,
        "logging_steps": 50,
        "eval_steps": 50,
        "save_steps": 50
      },
      "rules": []                      // No conditions - always runs
    },

    // ============================================
    // EXPERIMENT 2: More Data (Always Runs)
    // ============================================
    "exp2": {
      "run_always": true,
      "train_batch": "second_batch",   // Use second_batch (20% data)
      "model": {
        "model_name": "unsloth/Qwen3-0.6B",
        "rank": 32,
        "alpha": 64,
        "max_seq_len": 2048,
        "dropout": 0,
        "chat_template": "qwen3-instruct"
      },
      "sft": {
        "learning_rate": 2e-5,
        "batch_size": 8,
        "epochs": 2,
        "early_stopping_criteria": true,
        "logging_steps": 50,
        "eval_steps": 50,
        "save_steps": 50
      },
      "rules": []
    },

    // ============================================
    // EXPERIMENT 2.1: Lower Learning Rate (Conditional)
    // ============================================
    "exp2.1": {
      "run_always": true,
      "train_batch": "second_batch",
      "model": {
        "model_name": "unsloth/Qwen3-0.6B",
        "rank": 32,
        "alpha": 64,
        "max_seq_len": 2048,
        "dropout": 0,
        "chat_template": "qwen3-instruct"
      },
      "sft": {
        "learning_rate": 2e-6,         // Lower LR than exp2
        "batch_size": 8,
        "epochs": 2,
        "early_stopping_criteria": true,
        "logging_steps": 50,
        "eval_steps": 50,
        "save_steps": 50
      },
      
      // ============================================
      // RULES: Conditional Execution
      // ============================================
      // This experiment runs ONLY if ALL conditions are TRUE
      // Available operators: ">", "<", ">=", "<=", "==", "!="
      // Available metrics:
      //   - f1, precision, recall, latency (from evaluation)
      //   - last_train_loss, min_train_loss (from training logs)
      //   - last_eval_loss, min_eval_loss (from evaluation logs)
      // ============================================
      "rules": [
        {
          "conditions": [
            // Run if exp2's last training loss > minimum training loss
            // (indicates model hasn't converged)
            { "left": "exp2.last_train_loss", "op": ">", "right": "exp2.min_train_loss" }
          ]
        }
      ]
    },

    // ============================================
    // EXPERIMENT 3.1: Run if exp1 better than exp2
    // ============================================
    "exp3.1": {
      "run_always": false,             // Only runs if rules are satisfied
      "train_batch": "second_batch",
      "model": {
        "model_name": "unsloth/Qwen3-0.6B",
        "rank": 32,
        "alpha": 64,
        "max_seq_len": 2048,
        "dropout": 0,
        "chat_template": "qwen3-instruct"
      },
      "sft": {
        "learning_rate": 2e-5,
        "batch_size": 8,
        "epochs": 2,
        "early_stopping_criteria": false,
        "logging_steps": 50,
        "eval_steps": 50,
        "save_steps": 50
      },
      
      // ============================================
      // MULTIPLE CONDITIONS (ALL must be TRUE)
      // ============================================
      "rules": [
        {
          "conditions": [
            // Condition 1: exp1 has better F1 score than exp2
            { "left": "exp1.f1", "op": ">", "right": "exp2.f1" },
            
            // Condition 2: exp2's eval loss increased (overfitting)
            { "left": "exp2.last_eval_loss", "op": ">", "right": "exp2.min_eval_loss" },
            
            // Condition 3: exp2's train loss converged
            { "left": "exp2.last_train_loss", "op": "<=", "right": "exp2.min_train_loss" }
          ]
        }
      ]
    },

    // ============================================
    // EXPERIMENT 3.2: Run if exp2 better than exp1
    // ============================================
    "exp3.2": {
      "run_always": false,
      "train_batch": "third_batch",    // Use more data (30%)
      "model": {
        "model_name": "unsloth/Qwen3-0.6B",
        "rank": 32,
        "alpha": 64,
        "max_seq_len": 2048,
        "dropout": 0,
        "chat_template": "qwen3-instruct"
      },
      "sft": {
        "learning_rate": 5e-5,         // Higher LR
        "batch_size": 8,
        "epochs": 4,                   // More epochs
        "early_stopping_criteria": true,
        "logging_steps": 50,
        "eval_steps": 50,
        "save_steps": 50
      },
      
      "rules": [
        {
          "conditions": [
            // Condition 1: exp2 has better F1 than exp1
            { "left": "exp1.f1", "op": "<", "right": "exp2.f1" },
            
            // Condition 2: exp2's train loss converged
            { "left": "exp2.last_train_loss", "op": "<=", "right": "exp2.min_train_loss" },
            
            // Condition 3: exp2's eval loss converged (no overfitting)
            { "left": "exp2.last_eval_loss", "op": "<=", "right": "exp2.min_eval_loss" }
          ]
        }
      ]
    }
  }
}

// ============================================
// OPERATOR REFERENCE
// ============================================
// ">"  : Greater than
// "<"  : Less than
// ">=" : Greater than or equal to
// "<=" : Less than or equal to
// "==" : Equal to
// "!=" : Not equal to

// ============================================
// METRIC REFERENCE
// ============================================
// Format: "experiment_name.metric_name"
// Examples:
//   - "exp1.f1"              : F1 score from exp1 evaluation
//   - "exp2.precision"       : Precision from exp2 evaluation
//   - "exp2.recall"          : Recall from exp2 evaluation
//   - "exp2.latency"         : Average latency from exp2 evaluation
//   - "exp2.last_train_loss" : Last training loss from exp2
//   - "exp2.min_train_loss"  : Minimum training loss from exp2
//   - "exp2.last_eval_loss"  : Last evaluation loss from exp2
//   - "exp2.min_eval_loss"   : Minimum evaluation loss from exp2

// ============================================
// RULE LOGIC
// ============================================
// - If "run_always": true  → Experiment always runs (rules ignored)
// - If "run_always": false → Experiment runs ONLY if ALL conditions are TRUE
// - Empty "rules": []      → Same as "run_always": true
// - Multiple conditions    → ALL must be satisfied (AND logic)
